import 'package:flutter/material.dart';
import 'dart:ui';
import 'package:dart_tags/dart_tags.dart';
import 'dart:io';
// import 'package:just_audio/just_audio.dart';
import 'package:audioplayers/audioplayers.dart';
import 'package:flutter/widgets.dart';

class PlaylistPage extends StatefulWidget {
  final List<String> songs;
  const PlaylistPage({super.key, required this.songs});




  @override
  State<PlaylistPage> createState() => _PlaylistPageState();
}

class _PlaylistPageState extends State<PlaylistPage> {
  double _volumeValue = 0.7;
  bool _isPlaying = false;
  String _imagePath = '/home/zenar56/Загрузки/12331.jpg';
  // String _imagePath = '/home/zenar56/Музыка/Агата Кристи – Opium [LP] 2014/front.jpg';
  final player = AudioPlayer();                   // Create a player
  
  int nowPlayingIndex = 0;

  void _loadAudio() {
    final player = AudioPlayer();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.transparent,
      body: Center(
        child: Container(
          height: MediaQuery.of(context).size.height,
          width: MediaQuery.of(context).size.width,



          decoration: BoxDecoration(
              image: DecorationImage(
                          image: FileImage(File(_imagePath)),
                          fit: BoxFit.cover,
                          colorFilter: ColorFilter.mode(
                            Colors.black.withOpacity(0.25),
                            BlendMode.darken,
                          ),
              ),

            gradient: LinearGradient(
              
              colors: [
                Color.fromRGBO(44, 44, 48, 1),
                Color.fromRGBO(34, 34, 38, 1),
              ],
              begin: Alignment.topLeft,
              end: Alignment.bottomRight
            ),
          ),


          child: ClipRect(
            child: BackdropFilter(
              filter: ImageFilter.blur(
                sigmaX: 95.0,
                sigmaY: 95.0,
              ),
              child: Container(
                color: Colors.transparent,
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [

                    // dart_tags.DartTags.readTags(File(songs[0])).then((tags) {
                    // dart_tags.



                    Container(
                      height: 200,
                      width: 200,
                      decoration: BoxDecoration(
                        image: DecorationImage(
                          image: FileImage(File(_imagePath)),
                          fit: BoxFit.cover,
                          colorFilter: ColorFilter.mode(
                            Colors.black.withOpacity(0),
                            BlendMode.darken,
                          ),
                        ),
                        boxShadow: [
                          BoxShadow(
                            color: const Color.fromARGB(255, 21, 21, 21),
                            blurRadius: 10,
                            offset: Offset(5, 10),
                          ),
                        ],
                      ),
                    ),







                    SizedBox(height: 35),

                    // Text('ASGORE (SLOWED)',style: TextStyle(color: Colors.white, fontSize: 32, fontWeight: FontWeight.bold),),
                    Text(widget.songs[nowPlayingIndex].split('/').last,style: TextStyle(color: Colors.white, fontSize: 32, fontWeight: FontWeight.bold),),
                    Text('UNDERTALE OST',style: TextStyle(color: Colors.white, fontSize: 16, fontWeight: FontWeight.w300),),

                    SizedBox(height: 35),




                    






                    Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Material(
                          color: Colors.transparent,
                          borderRadius: BorderRadius.all(Radius.circular(20)),
                          
                          child: InkWell(
                            borderRadius: BorderRadius.all(Radius.circular(10)),
                            onTap: () {
                              setState(() {
                                nowPlayingIndex--;
                                if (nowPlayingIndex < 0) {
                                  nowPlayingIndex = widget.songs.length - 1;
                                }
                              });
                              player.stop();
                              player.play(DeviceFileSource(widget.songs[nowPlayingIndex]));
                            },
                            child: Container(
                              height: 40,
                              width: 40,

                              decoration: BoxDecoration(
                                color: const Color.fromRGBO(56, 56, 59, 1),
                                borderRadius: BorderRadius.all(Radius.circular(30)),
                              ),
                              child: Row(
                                  mainAxisAlignment: MainAxisAlignment.center,
                                  children: [
                                    Icon(Icons.skip_previous, color: Colors.white, size: 24),
                                  ],
                                ),
                            
                              )

                            ),
                        
                        ),





                        SizedBox(width: 15),





                        Material(
                          color: Colors.transparent,
                          borderRadius: BorderRadius.all(Radius.circular(20)),
                          
                          child: InkWell(
                        borderRadius: BorderRadius.all(Radius.circular(10)),
                        onTap: () {
                          setState(() {
                            _isPlaying = !_isPlaying;

                            if (!_isPlaying) {
                              player.pause();
                            } else {
                              player.play(DeviceFileSource(widget.songs[nowPlayingIndex]));
                            }
                          });

                          // player.play(DeviceFileSource(widget.songs[0]));
                        },
                        child: Container(
                          height: 50,
                          width: 50,

                          decoration: BoxDecoration(
                            color: const Color.fromRGBO(56, 56, 59, 1),
                            borderRadius: BorderRadius.all(Radius.circular(30)),
                          ),
                          child: Row(
                              mainAxisAlignment: MainAxisAlignment.center,
                              children: [
                                Icon(
                                  _isPlaying ? Icons.pause : Icons.play_arrow,
                                  color: Colors.white,
                                  size: 28
                                ),
                              ],
                            ),
                        
                          )

                        ),
                    
                    ),





                    SizedBox(width: 15),





                    Material(
                      color: Colors.transparent,
                      borderRadius: BorderRadius.all(Radius.circular(20)),
                      
                      child: InkWell(
                        borderRadius: BorderRadius.all(Radius.circular(10)),
                        onTap: () {
                          setState(() {
                            nowPlayingIndex++;
                            if (nowPlayingIndex >= widget.songs.length) {
                              nowPlayingIndex = 0;
                            }
                            player.stop();
                            player.play(DeviceFileSource(widget.songs[nowPlayingIndex]));
                          });
                        },
                        child: Container(
                          height: 40,
                          width: 40,

                          decoration: BoxDecoration(
                            color: const Color.fromRGBO(56, 56, 59, 1),
                            borderRadius: BorderRadius.all(Radius.circular(30)),
                          ),
                          child: Row(
                              mainAxisAlignment: MainAxisAlignment.center,
                              children: [
                                Icon(Icons.skip_next, color: Colors.white, size: 24),
                              ],
                            ),
                        
                          )

                        ),
                    
                    ),


                  ],),





                    // Padding(
                    //   padding: EdgeInsets.symmetric(horizontal: 20),
                    //   child: SliderTheme(
                    //     data: SliderThemeData(
                    //       activeTrackColor: Colors.white,
                    //       inactiveTrackColor: Colors.white.withOpacity(0.3),
                    //       thumbColor: Colors.white,
                    //       overlayColor: Colors.white.withOpacity(0.1),
                    //       trackHeight: 2.0,
                    //     ),
                    //     child: Slider(
                    //       value: 0.5,
                    //       onChanged: (value) {},
                    //     ),
                    //   ),
                    // ),

                    // SizedBox(height: 20),
                    SizedBox(height: 15),

                    Padding(
                      padding: EdgeInsets.symmetric(horizontal: 40),
                      child: Row(


                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [




                          Icon(Icons.volume_down, color: Colors.white, size: 20),





                          SizedBox(width: 10),
                          Container(
                            width: 200,
                            child: SliderTheme(
                              data: SliderThemeData(
                                activeTrackColor: Colors.white,
                                inactiveTrackColor: Colors.white.withOpacity(0.3),
                                thumbColor: Colors.transparent,
                                overlayColor: Colors.transparent,
                                trackHeight: 12.5,
                                thumbShape: SliderComponentShape.noThumb,
                                overlayShape: SliderComponentShape.noOverlay,
                              ),
                              child: Slider(
                                value: _volumeValue,
                                onChanged: (value) {
                                  setState(() {
                                    _volumeValue = value;
                                    player.setVolume(_volumeValue);
                                  });
                                  print(_volumeValue);
                                },
                              ),
                            ),
                          ),

                          SizedBox(width: 10),
                          Icon(Icons.volume_up, color: Colors.white, size: 20),



                        ],




                      ),
                    ),



  
                  SizedBox(height: 20),




                  Row(

                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Material(
                        color: Colors.transparent,
                        borderRadius: BorderRadius.all(Radius.circular(20)),
                        
                        child: InkWell(
                          borderRadius: BorderRadius.all(Radius.circular(10)),
                          onTap: () {},
                          child: Container(
                            height: 35,
                            width: 35,

                            decoration: BoxDecoration(
                              color: const Color.fromRGBO(56, 56, 59, 1),
                              borderRadius: BorderRadius.all(Radius.circular(30)),
                            ),
                            child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Icon(Icons.featured_play_list_outlined, color: Colors.white, size: 20),
                                ],
                              ),
                          
                            )

                          ),
                      
                      ),


                      SizedBox(width: 15),


                      Material(
                        color: Colors.transparent,
                        borderRadius: BorderRadius.all(Radius.circular(20)),
                        
                        child: InkWell(
                          borderRadius: BorderRadius.all(Radius.circular(10)),
                          onTap: () {},
                          child: Container(
                            height: 35,
                            width: 35,

                            decoration: BoxDecoration(
                              color: const Color.fromRGBO(56, 56, 59, 1),
                              borderRadius: BorderRadius.all(Radius.circular(30)),
                            ),
                            child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Icon(Icons.shuffle, color: Colors.white, size: 20),
                                ],
                              ),
                          
                            )

                          ),
                      
                      ),


                      SizedBox(width: 75),


                      Material(
                        color: Colors.transparent,
                        borderRadius: BorderRadius.all(Radius.circular(20)),
                        
                        child: InkWell(
                          borderRadius: BorderRadius.all(Radius.circular(10)),
                          onTap: () {},
                          child: Container(
                            height: 35,
                            width: 35,

                            decoration: BoxDecoration(
                              color: const Color.fromRGBO(56, 56, 59, 1),
                              borderRadius: BorderRadius.all(Radius.circular(30)),
                            ),
                            child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Icon(Icons.repeat_outlined, color: Colors.white, size: 20),
                                ],
                              ),
                          
                            )

                          ),
                      
                      ),


                      SizedBox(width: 15),


                      Material(
                        color: Colors.transparent,
                        borderRadius: BorderRadius.all(Radius.circular(20)),
                        
                        child: InkWell(
                          borderRadius: BorderRadius.all(Radius.circular(10)),
                          onTap: () {},
                          child: Container(
                            height: 35,
                            width: 35,

                            decoration: BoxDecoration(
                              color: const Color.fromRGBO(56, 56, 59, 1),
                              borderRadius: BorderRadius.all(Radius.circular(30)),
                            ),
                            child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Icon(Icons.shuffle, color: Colors.white, size: 20),
                                ],
                              ),
                          
                            )

                          ),
                      
                      ),








                      
                    ],
                  ),


                    // SizedBox(height: 20),
                    // Expanded(
                    //   child: ListView.builder(
                    //     itemCount: songs.length,
                    //     itemBuilder: (context, index) {
                    //       return ListTile(
                    //         title: Text(
                    //           songs[index].split('/').last,
                    //           style: TextStyle(color: Colors.white),
                    //         ),
                    //       );
                    //     },
                    //   ),
                    // ),
















                  ],
                ),
              ),
            ),
          ),
        ),
      ),
    );
  }
} 